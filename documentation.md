# Документация по скриптам

Набор bash-скриптов для:

- анализа результатов тестов по предметам (Часть I);
- работы с досье студентов и средними оценками (Часть II).

## Структура проекта

```
.
├── config/
│   └── app.env
├── data/
│   └── labfiles-25/
│       ├── Цирковое_Дело/tests/TEST-* …
│       ├── Поп-Культуроведение/tests/TEST-* …
│       └── students/
│           ├── groups/
│           └── general/notes
├── src/
│   └── scripts/
│       ├── main.sh           # Часть I: анализ тестов
│       ├── student_notes.sh  # Часть II.1: досье
│       ├── avg_score.sh      # Часть II.2: средний балл по предмету
│       └── lib/
│           ├── io.sh
│           ├── paths.sh
│           ├── parser.sh
│           └── stats.sh
├── src/tests/unit_tests/
│   ├── conftest.py
│   ├── test_group_validation.py
│   └── test_happy_path.py
└── documentation.md
```

---

## Часть I. Анализ результатов тестов (`main.sh`)

Скрипт `main.sh` работает по конкретной группе и предмету и:

- ищет студента(ов) с максимальным числом **правильных** ответов;
- ищет студента(ов) с максимальным числом **неправильных** ответов;
- может обрабатывать как один тест, так и все тесты предмета.

Количество вопросов по предметам зашито в коде:

- `Цирковое_Дело` — 25;
- `Поп-Культуроведение` — 5.

### Быстрый старт для `main.sh`

```bash
chmod +x src/scripts/main.sh src/scripts/lib/*.sh

./src/scripts/main.sh   --group=Ae-21-22   --subject="Цирковое_Дело" --action=both
```

### Режимы работы с тестами

- Если указан `--test=TEST-N`, скрипт анализирует только этот тест.
- Если флаг `--test` не указан, используются **все** файлы `TEST-*` по выбранному предмету.

### Флаги `main.sh`

```bash
./src/scripts/main.sh   --group=<строка>   --subject=<строка>   [--test=<имя>]   --action=<режим>
```

| Флаг       | Пример                                  | Обязательно | Назначение                                                                 |
|-----------|------------------------------------------|------------|----------------------------------------------------------------------------|
| `--group`   | `--group=Ae-21-22`                      | да         | Номер группы. Пробелы по краям автоматически обрезаются.                   |
| `--subject` | `--subject="Цирковое_Дело"`             | да         | Предмет: `Цирковое_Дело` или `Поп-Культуроведение`.                        |
| `--test`    | `--test=TEST-1`                         | нет        | Имя файла теста (`TEST-1` … `TEST-4`). Если не указан — берутся все тесты предмета. |
| `--action`  | `--action=both`                         | да         | Режим вывода: `max-correct`, `max-wrong`, `both`.                          |

Поведение при ошибках:

- если не передан один из обязательных флагов (`--group`, `--subject`, `--action`), скрипт печатает сообщение вида  
  `Необходимо указать флаг --group` + краткую справку по использованию и завершает работу с кодом `1`;
- при отсутствии файла теста — ошибка и код возврата `1`;
- при отсутствии группы в тестах выбранного предмета — ошибка и код `1` + вывод списка доступных групп в `stderr`.

Основной вывод (результаты анализа) печатается в `stdout`, служебные сообщения и ошибки — в `stderr`.

---

## Часть II.1. Просмотр и редактирование досье (`student_notes.sh`)

Скрипт `student_notes.sh` реализует требования раздела «2.1. Просмотр и редактирование досье».

Функциональность:

- по фамилии студента вывести его досье;
- добавить новую фразу в досье.

### Входные данные и запуск

Фамилия студента задаётся как **позиционный аргумент командной строки**:

```bash
./student_notes.sh RusinAN
# или в рамках проекта:
bash ./src/scripts/student_notes.sh RusinAN
```

Для редактирования досье используется флаг `--add`:

```bash
bash ./src/scripts/student_notes.sh RusinAN --add
```

После запуска с `--add` скрипт спрашивает новую запись через `read`:

```text
Введите новую запись:
> Рекомендован к участию в олимпиаде.
```

### Формат и хранение досье

Досье хранятся в каталоге:

- основной вариант по ТЗ: `{LAB_ROOT}/students/general/notes`;
- при отсутствии каталога `notes` допускается `{LAB_ROOT}/students/general`.

Файл выбирается по первой букве фамилии студента (через `get_notes_file_for_student` из `paths.sh`) и имеет расширение `.log`.

Внутри файла досье одного студента хранится блок вида:

```text
====================
RusinAN
Первая строка досье
Вторая строка досье
====================
```

Новая фраза добавляется **новой строкой** перед нижней линией `====`.

Изменения выполняются прямо в исходном файле без создания копий.

### Вывод

При просмотре (`./student_notes.sh RusinAN`) досье целиком печатается в `stdout` в формате:

```text
Досье студента RusinAN: Постоянно делает селфи. Не знает, что такое StackOverflow. …
```

Строки досье объединяются через пробел, сообщения об ошибках выводятся в `stderr`.

---

## Часть II.2. Подсчёт средней оценки по предмету (`avg_score.sh`)

Скрипт `avg_score.sh` реализует требования раздела «2.2. Подсчёт средней оценки по предмету».

Функциональность:

- вычисление средней оценки по указанному предмету и фамилии студента;
- учитываются **все попытки**, включая неудачные;
- знаки `+` и `-` в оценках игнорируются (`5+` считается как `5`).

### Входные данные и запуск

Фамилия и предмет задаются как позиционные аргументы:

```bash
./avg_score.sh RusinAN Цирковое_Дело
# в проекте:
bash ./src/scripts/avg_score.sh RusinAN Цирковое_Дело
```

Используются все файлы `TEST-*` из каталога предмета:

```text
{LAB_ROOT}/{subject}/tests/TEST-*
```

### Расчёт

Для всех строк всех файлов `TEST-*` по выбранному предмету берутся записи, где:

- во втором столбце указано `ФамилияИО` студента;
- пятый столбец содержит оценку.

Из столбца оценки удаляются знаки `+` и `-`, затем строка приводится к числу. Учитываются все такие оценки, в том числе низкие.

Средняя оценка считается как:

```text
avg = sum(оценок) / count(оценок)
```

и выводится с точностью **до двух знаков** после запятой.

### Вывод

Результат печатается в `stdout` в виде:

```text
Средняя оценка студента RusinAN по предмету Цирковое_Дело: 4.27
```

Если для студента по предмету нет оценок, выводится сообщение:

```text
Оценки студента RusinAN по предмету Цирковое_Дело не найдены
```

Сообщения об ошибках (например, если каталог с тестами не найден) выводятся в `stderr`.

---

## Требования к окружению

- bash ≥ 4  
- Unix-подобная ОС (Linux/macOS)  
- Путь к данным задаётся через:
  - переменную окружения `DATA_ROOT`, либо
  - файл `config/app.env` (по умолчанию указывает на `data/labfiles-25`).
