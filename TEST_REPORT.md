# TEST_REPORT.md — Мини-отчёт по ручному тестированию

**Дата:** 2025-11-05  
**Статус:** ✅ Успешно (все сценарии пройдены)

---

## 1) Краткое резюме
- **Объект тестирования:** `src/scripts/main.sh` и библиотечные скрипты (`lib/io.sh`, `lib/paths.sh`, `lib/stats.sh`, `lib/parser.sh`).
- **Цель:** проверить режимы `max-correct`, `max-wrong`, `both`; обработку флагов `--group/--subject/--test/--add-dosier/--view-dossier/--average-grade`; интерактив; приоритет `DATA_ROOT`; разделение stdout/stderr; ошибки «файл теста/группа/предмет».
- **Итог:** поведение соответствует документации и ожидаемым результатам.

## 2) Среда
- ОС/шелл: Unix-подобная (Linux/macOS), bash ≥ 4.
- Права исполнения на скрипты выданы (`chmod +x src/scripts/main.sh src/scripts/lib/*.sh`).
- Конфигурация `DATA_ROOT`:
  - Проверены обе поддерживаемые структуры (`/data` и `/data/labfiles-25`).
  - Приоритет ENV над `config/app.env` подтверждён.
  - Относительные пути нормализуются в абсолютные.
- Данные/ветка/коммит: *по проекту*.

## 3) Результаты сценариев

| ID  | Сценарий | Команда/действия (пример) | Ожидаемое поведение | Итог |
|----:|---|---|---|---|
| A1 | Все флаги, `--action=both` | `DATA_ROOT=... ./src/scripts/main.sh --group=Ae-21-22 --subject="Цирковое_Дело" --test=TEST-1 --action=both` | Печать обоих максимумов (прав./неправ.) | **Pass** |
| A2 | Только `max-correct` | `--action=max-correct` | Печать только блока «максимум правильных» | **Pass** |
| A3 | Только `max-wrong` | `--action=max-wrong` | Печать только блока «максимум неправильных» | **Pass** |
| A4 | Структура `/data/labfiles-25` | `DATA_ROOT=/…/data/labfiles-25 ...` | Результаты совпадают с A1 | **Pass** |
| A5 | Нормализация абсолютного пути | `DATA_ROOT=./data ...` | Скрипт переводит в абсолютный путь | **Pass** |
| A6 | Интерактив без флагов | запуск без флагов | Подсказки/меню → **stderr**, значения → **stdout** | **Pass** |
| A7 | Обрезка пробелов в `--group` | `--group="  Ae-21-22  "` | Группа распознана как `Ae-21-22` | **Pass** (исправлено в коммите `4f458a38c1ef6ec78015e227a755b67bc44e497a`) |
| A8 | Оба предмета | subject=`Цирковое_Дело` (25 вопросов) и `Поп-Культуроведение` (5) | Оба предмета корректны | **Pass** |
| B9 | Приоритет ENV | env ≠ `config/app.env` | Берётся значение из ENV | **Pass** |
| C10 | Тест не найден | `--test=TEST-999` | Ошибка, код выхода `1` | **Pass** |
| C11 | Группа не найдена | `--group=Zz-00-00` | Ошибка со списком групп, код `1` | **Pass** |
| C12 | Неверный `--subject` | `--subject="Математика"` | Ошибка валидации | **Pass** |
| C13 | Разделение потоков | `>stdout.log 2>stderr.log` | Подсказки—stderr, значения—stdout | **Pass** |
| D1 | Просмотр существующего досье | `./main.sh --student=MartsevoyYA --subject="Поп-Культуроведение" --action=view-dossier` | Печать досье в формате из ТЗ: заголовок, предмет, даты, раздел «Фразы» с нумерацией | **Pass** |
| D2 | Просмотр досье без указания предмета | `./main.sh --student=MartsevoyYA --action=view-dossier` | Проверяется существование студента; выводится полное досье (если дисциплина однозначна/лежит в структуре предмета) | **Pass** |
| D3 | Досье не найдено | `./main.sh --student=Несуществов --action=view-dossier` | Сообщение: `Студент не найден` | **Pass** |
| D4 | Пустое досье | Подготовить пустой файл досье и выполнить D1 | Сообщение: `Досье пустое` | **Pass** |
| D5 | Добавление новой фразы | `./main.sh --student=MartsevoyYA --subject="Поп-Культуроведение" --action=add-dossier --phrase="Отлично ответил на вопросы"` | Подтверждение добавления; в досье появляется новая фраза с авто-нумерацией; обновляется «Последнее обновление» | **Pass** |
| D6 | Автосоздание досье | `./main.sh --student=Петров --subject="Цирковое_Дело" --action=add-dossier --phrase="Активно работал на семинаре"` | Если досье отсутствовало, создаётся; далее как D5 | **Pass** |
| D7 | Проверка существования студента | `./main.sh --student=Zz-Student --subject="Поп-Культуроведение" --action=add-dossier --phrase="..."` | При отсутствии студента в системе — информативное сообщение об ошибке (без создания артефактов) | **Pass** (исправлено в коммите 1fdc0133e7e3c72badc85aedfbf82faada7ea9e8 |
| G1 | Базовый расчёт средней | `./main.sh --student=MartsevoyYA --subject="Поп-Культуроведение" --action=average-grade` | Формат вывода: ФИО, предмет, количество тестов, список оценок (опц.), «Средняя оценка: X.XX» с округлением до 2 знаков | **Pass** |
| G2 | Студент не найден в тестах предмета | `./main.sh --student=MartsevoyYA --subject="Цирковое_Дело" --action=average-grade` (если нет попыток) | Сообщение: `Студент не найден` | **Pass** |
| G3 | Учитывать только тесты с участием студента | Выполнить расчёт при наличии тестов, где студент отсутствовал | В рассчёт попадают только тесты, где студент присутствовал | **Pass** |
| G4 | Проверка округления | Данные с дробной суммой/кол-вом тестов | Значение средней округляется математически до 2 знаков (например, 4.666… → 4.67) | **Pass** |


## 4) Найденные проблемы
| ID | Заголовок | Статус | Шаги воспроизведения | Ожидание | Факт | Коммит/фикс | Severity |
|---:|---|---|---|---|---|---|---|
| BUG-1 (A7) | Обрезка пробелов в `--group` не применялась | **Resolved** | Запуск с `--group="  Ae-21-22  "` | Значение `Ae-21-22` без пробелов | Скрипт воспринимал пробелы как часть значения | Исправлено в `4f458a38c1ef6ec78015e227a755b67bc44e497a` | Minor |
| BUG-2 (D7) | Проверка существования студента в `--add-dossier` не применялась  | **Resolved** | Запуск с `--add-dossier=abcdr` | Вывод сообщения: Студент не найден | Создавалось досье с указанным именем | Исправлено в `1fdc0133e7e3c72badc85aedfbf82faada7ea9e8` | Minor |

## 5) Рекомендации
- Поведение и документация согласованы. Дополнительно можно:
  - Добавить флаг `--version`/`--help` в вывод `stdout` при явном запросе, оставив интерактивные подсказки в `stderr`.
  - Локально поддерживать `pytest`/Docker-прогон как pre-commit hook.

## 6) Автотесты
- **Набор:** unit-тесты из `src/tests/unit_tests` (локальный прогон через `pytest`; возможен также Docker-прогон).
- **Покрытие:** базовые позитивные сценарии (валидные `--group/--subject/--test`, режимы `both`, `max-correct`, `max-wrong`, корректная работа `DATA_ROOT`).
- **Результат:** ✅ Все автотесты пройдены.
- **Как запускать локально:**
  ```bash
  pip install -q pytest
  pytest -q src/tests/unit_tests
  ```
- **Как запускать в Docker:**
  ```bash
  docker build -t os-project-tests .
  docker run --rm os-project-tests
  ```

