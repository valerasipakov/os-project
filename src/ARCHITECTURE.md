# Архитектура и устройство проекта

Документ описывает назначение файлов, потоки данных и ключевые решения.

---

## Дерево

```
.
├── config/
│   └── app.env
├── data/ | labfiles-25/
├── src/
│   └── scripts/
│       ├── main.sh
│       └── lib/
│           ├── io.sh
│           ├── paths.sh
│           ├── parser.sh
│           ├── stats.sh
└── src/tests/unit_tests/
    ├── conftest.py
    ├── test_happy_path.py
    └── test_group_validation.py
```

---

## Роли файлов

- `config/app.env` — единая точка настройки `DATA_ROOT`. Поддерживает `${PROJECT_ROOT}`.
- `src/scripts/main.sh` — orchestration: загрузка конфигурации, нормализация `DATA_ROOT`, ввод параметров, валидации, запуск вычислений и форматирование результата.
- `src/scripts/lib/io.sh` — интерактивный ввод. Меню и подсказки в `stderr`, значения в `stdout`.
- `src/scripts/lib/paths.sh` — слой путей и данных. Использует **только** `DATA_ROOT` для вычисления `LAB_ROOT`. Не применяет эвристики.
- `src/scripts/lib/parser.sh` — парсинг флагов.
- `src/scripts/lib/stats.sh` — бизнес‑логика:
  - `group_exists` — проверка наличия группы через точное сравнение первого поля (awk).
  - `list_groups` — уникальные группы из файла.
  - `find_max_for_group` — итерация по файлу, вычисление максимумов правильных/неправильных.
- `src/tests/unit_tests/*` — юнит‑тесты для позитивных сценариев и валидаций.

---

## Поток выполнения

1. `main.sh` подхватывает `DATA_ROOT` из окружения, иначе — из `config/app.env`.
2. Превращает `DATA_ROOT` в абсолютный путь.
3. Подключает `io.sh`, `paths.sh`, `stats.sh`.
4. Считывает параметры (CLI или интерактивно).
5. Строит путь к файлу теста (`get_tests_file`), проверяет наличие.
6. Проверяет существование группы (`group_exists`).
7. Считает максимумы (`find_max_for_group`) и печатает результат.

---

## Формат входных данных

```
<Группа>;<ФамилияИО>;<Дата>;<Правильных>;<Оценка>
```

Неправильных = `<Всего по предмету>` − `<Правильных>`.  
Маппинг задаётся в `get_total_questions()`.

---

## Ввод/вывод

- Ввод: CLI‑флаги или интерактивные вопросы.
- Вывод: результат в stdout. Промпты и вспомогательные списки — в stderr.

---

## Валидации и завершения

- Отсутствует файл теста → ошибка, код `1`.
- Не найдена группа → ошибка, код `1` + список допустимых групп.
- Трим пробелов у группы.
- Любая критическая ошибка печатается в stderr.

---

## Тестирование

- Временная структура данных создаётся фикстурами `tmp_labfiles`.
- `env_with_dataroot` гарантирует, что скрипт читает именно тестовые данные.
- Тесты проверяют содержимое stdout/stderr и коды возврата.

---

## Docker

`Dockerfile`:
- базовый образ `python:3.11-slim`;
- установка bash и pytest;
- копирование `src/` и `config/`;
- выставление прав на `*.sh`;
- запуск `pytest -q src/tests/unit_tests`.

Запуск:
```bash
docker build -t os-project-tests .
docker run --rm os-project-tests
```

---
