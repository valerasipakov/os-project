# Техническое задание: Расширенная функциональность системы

## Функциональные требования

### 2.1 Система досье студентов

#### 2.1.1 Просмотр досье студента

**Описание:** Возможность просмотра досье студента по фамилии

**Входные данные:**
- Фамилия студента (обязательно)
- Предмет (опционально, для проверки существования студента)

**Выходные данные:**
- Полное досье студента в формате:
```
Досье студента: Иванов И.И.
Предмет: Поп-Культуроведение
Дата создания: 2024-10-15
Последнее обновление: 2024-10-20

Фразы:
1. Отлично проявил себя на семинаре 12.10.2024
2. Активно участвовал в групповом проекте
3. [Фраза 3...]
```

**Бизнес-правила:**
- Если досье не существует - выводить сообщение "Досье не найдено"
- Если досье пустое - выводить "Досье пустое"
- Проверять существование студента в системе перед показом досье

#### 2.1.2 Добавление фраз в досье

**Описание:** Возможность добавления новых фраз в досье студента

**Входные данные:**
- Фамилия студента (обязательно)
- Новая фраза (обязательно)
- Предмет (опционально)

**Выходные данные:**
- Подтверждение успешного добавления
- Обновленное досье с новой фразой

**Бизнес-правила:**
- Автоматическое создание досье при первом добавлении фразы
- Автоматическая нумерация фраз
- Добавление даты последнего обновления
- Проверка существования студента в системе

### 2.2 Расчет средней оценки студента

#### 2.2.1 Вывод средней оценки по предмету

**Описание:** Расчет и вывод средней оценки студента по всем тестам предмета

**Входные данные:**
- Фамилия студента (обязательно)
- Предмет (обязательно)

**Выходные данные:**
- Средняя оценка с точностью до 2 знаков после запятой
- Количество тестов, в которых участвовал студент
- Список оценок по тестам (опционально)

**Формат вывода:**
```
Студент: Иванов И.И.
Предмет: Поп-Культуроведение
Участвовал в тестах: 3
Оценки: 5, 4, 5
Средняя оценка: 4.67
```

**Бизнес-правила:**
- Расчет: `СРЕДНЯЯ = SUM(оценки) / COUNT(тесты)`
- Округление до 2 знаков после запятой
- Если студент не найден в тестах предмета - сообщение "Студент не найден"
- Учитывать только тесты, где студент присутствует

---

## Технические требования

### Структура данных

#### Хранение досье
```
DATA_ROOT/
├── labfiles-25/
│   ├── Цирковое_Дело/
│   │   ├── tests/
│   │   └── dossiers/          # Новая директория
│   │       ├── Иванов.dossier
│   │       └── Петров.dossier
│   └── Поп-Культуроведение/
│       ├── tests/
│       └── dossiers/
│           ├── Сидоров.dossier
│           └── Иванов.dossier
```

#### Формат файла досье
```
Фамилия: Иванов
Имя: Иван Иванович
Предмет: Поп-Культуроведение
Дата создания: 2024-10-15 14:30:00
Последнее обновление: 2024-10-20 16:45:00

ФРАЗЫ:
1. Отлично проявил себя на семинаре 12.10.2024
2. Активно участвовал в групповом проекте
3. Показал глубокое понимание темы поп-культуры
```

### Интерфейс командной строки

#### Новые аргументы:
```bash
# Для работы с досье
--student=ФАМИЛИЯ          # Фамилия студента (обязательно)
--action=view-dossier      # Просмотр досье
--action=add-dossier       # Добавление в досье
--phrase="Текст фразы"     # Фраза для добавления (для add-dossier)

# Для расчета средней оценки
--student=ФАМИЛИЯ          # Фамилия студента (обязательно)  
--subject=ПРЕДМЕТ          # Предмет (обязательно)
--action=average-grade     # Расчет средней оценки
```

#### Примеры использования:
```bash
# Просмотр досье
./main.sh --student=Иванов --subject="Поп-Культуроведение" --action=view-dossier

# Добавление фразы в досье
./main.sh --student=Иванов --subject="Поп-Культуроведение" --action=add-dossier --phrase="Отлично ответил на вопросы"

# Расчет средней оценки
./main.sh --student=Иванов --subject="Поп-Культуроведение" --action=average-grade
```

---

## Техническое задание для разработчика

### Задача 2.1: Реализация модуля досье

#### Функции модуля `dossiers.sh`:

```bash
# Проверка существования досье
dossier_exists() {
  local subject="$1"
  local student="$2"
  # Возвращает 0 если существует, 1 если нет
}

# Создание нового досье
create_dossier() {
  local subject="$1"
  local student="$2"
  # Создает файл с базовой структурой
}

# Просмотр досье
view_dossier() {
  local subject="$1"
  local student="$2"
  # Выводит содержимое досье в stdout
}

# Добавление фразы в досье
add_to_dossier() {
  local subject="$1"
  local student="$2"
  local phrase="$3"
  # Добавляет фразу с автоматической нумерацией
  # Обновляет дату последнего изменения
}

# Получение пути к файлу досье
get_dossier_path() {
  local subject="$1"
  local student="$2"
  # Возвращает полный путь к файлу досье
}
```

### Задача 2.2: Реализация модуля статистики оценок

#### Функции модуля `grades.sh`:

```bash
# Поиск студента в тестах предмета
find_student_in_subject() {
  local subject="$1"
  local student="$2"
  # Возвращает список тестов и оценок студента
}

# Расчет средней оценки
calculate_average_grade() {
  local subject="$1"
  local student="$2"
  # Возвращает среднюю оценку с точностью до 2 знаков
}

# Получение списка оценок
get_student_grades() {
  local subject="$1"
  local student="$2"
  # Возвращает массив оценок студента по предмету
}
```

### Задача 2.3: Интеграция с главным скриптом

#### Изменения в `main.sh`:

```bash
# Добавление обработки новых аргументов
case "$arg" in
  --student=*) STUDENT="${arg#*=}" ;;
  --phrase=*) PHRASE="${arg#*=}" ;;
esac

# Добавление новых действий
case "${ACTION}" in
  view-dossier)
    # Вызов функции просмотра досье
    ;;
  add-dossier)
    # Вызов функции добавления в досье
    ;;
  average-grade)
    # Вызов функции расчета средней оценки
    ;;
esac
```

---

## Техническое задание для тестировщика

### Тестовые сценарии для системы досье

#### Тест-кейс D-01: Просмотр несуществующего досье
**Предусловие:** Досье студента не существует
**Действия:**
1. Выполнить команду просмотра досье для несуществующего студента
**Ожидаемый результат:** Сообщение "Досье не найдено для студента: [Фамилия]"

#### Тест-кейс D-02: Создание нового досье
**Предусловие:** Студент существует в системе, досье отсутствует
**Действия:**
1. Добавить первую фразу в досье студента
**Ожидаемый результат:**
- Создан файл досье с правильной структурой
- Фраза добавлена с номером 1
- Указаны дата создания и обновления

#### Тест-кейс D-03: Добавление фраз в существующее досье
**Предусловие:** Досье студента уже существует с 2 фразами
**Действия:**
1. Добавить новую фразу в досье
**Ожидаемый результат:**
- Новая фраза добавлена с номером 3
- Дата обновления изменена
- Старые фразы сохранены

#### Тест-кейс D-04: Просмотр досье с несколькими фразами
**Предусловие:** Досье содержит 3 фразы
**Действия:**
1. Просмотреть досье студента
**Ожидаемый результат:**
- Выводится полная информация о студенте
- Все 3 фразы отображаются с правильной нумерацией
- Отображаются даты создания и обновления

### Тестовые сценарии для расчета средней оценки

#### Тест-кейс G-01: Студент с одной оценкой
**Предусловие:** Студент участвовал только в одном тесте с оценкой 5
**Действия:**
1. Рассчитать среднюю оценку студента
**Ожидаемый результат:** Средняя оценка = 5.00

#### Тест-кейс G-02: Студент с несколькими оценками
**Предусловие:** Студент участвовал в 3 тестах с оценками 5, 4, 5
**Действия:**
1. Рассчитать среднюю оценку студента
**Ожидаемый результат:** Средняя оценка = 4.67

#### Тест-кейс G-03: Студент не найден в тестах
**Предусловие:** Студент не участвовал в тестах предмета
**Действия:**
1. Рассчитать среднюю оценку студента
**Ожидаемый результат:** Сообщение "Студент [Фамилия] не найден в тестах предмета [Предмет]"

#### Тест-кейс G-04: Округление средней оценки
**Предусловие:** Студент участвовал в 3 тестах с оценками 4, 5, 4
**Действия:**
1. Рассчитать среднюю оценку студента
**Ожидаемый результат:** Средняя оценка = 4.33 (13/3 = 4.333... округлено до 4.33)

### Интеграционные тесты

#### Тест-кейс I-01: Комбинированный сценарий
**Действия:**
1. Добавить фразу в досье студента
2. Просмотреть досье студента
3. Рассчитать среднюю оценку студента
**Ожидаемый результат:** Все операции выполняются корректно

#### Тест-кейс I-02: Валидация существования студента
**Предусловие:** Студент не существует в системе
**Действия:**
1. Попытаться добавить фразу в досье
**Ожидаемый результат:** Сообщение об ошибке "Студент не найден в системе"
