
# os-project

## Команда работавшая над проектоме
Сипаков В.А. Аэ-21-22 менеджер  
Марцевой Я.А. Аэ-21-22 тестировщик  
Збуривский К.А. Аэ-21-22 разработчик  
Терехов С.Р. Аэ-21-22 аналитик

# Проект: Анализ результатов тестов (Bash)

Набор bash‑скриптов для анализа результатов тестов по заданным **группе**, **предмету** и **тесту**.  
Скрипт выводит:
- имя(имена) студента(ов) с **максимальным числом правильных** ответов и значение;
- имя(имена) студента(ов) с **максимальным числом неправильных** ответов и значение.

> Количество вопросов по предметам:
> - `Цирковое_Дело` — 25
> - `Поп-Культуроведение` — 5

---

## Структура

```
.
├── config/
│   └── app.env                   # централизованная настройка DATA_ROOT
├── data/                         # реальные данные (в проде)
│   └── labfiles-25/              # или без подкаталога — поддерживается
│       └── <Предмет>/
│           ├── tests/            # результаты тестов по предмету
│           └── dossiers/         # файлы досье студентов (создаются автоматически)
├── src/
│   └── scripts/
│       ├── main.sh               # точка входа
│       └── lib/
│           ├── io.sh             # интерактивный ввод (stdout только значения)
│           ├── paths.sh          # работа с DATA_ROOT, резолв путей
│           ├── parser.sh         # Парсер флагов
│           ├── stats.sh          # валидация группы, расчёт максимумов
└── src/tests/
    └── unit_tests/               # pytest‑тесты
        ├── conftest.py
        ├── test_happy_path.py
        └── test_group_validation.py
```

---

## Требования

- bash ≥ 4
- Unix‑подобная ОС (Linux/macOS)
- Для тестов: Python 3.11+ и `pytest` (или Docker)

---

## Установка прав

```bash
chmod +x src/scripts/main.sh src/scripts/lib/*.sh
```

---

## Конфигурация `DATA_ROOT`

`DATA_ROOT` задаёт корень данных. Поддерживаются два варианта структуры:

- `DATA_ROOT=/path/to/data/labfiles-25`
- `DATA_ROOT=/path/to/data` (будет автоматически использован подкаталог `labfiles-25`, если он есть)

Способы задать:

1) Через `config/app.env`:
```bash
DATA_ROOT="${PROJECT_ROOT}/data"             # или ${PROJECT_ROOT}/data/labfiles-25
```

2) Переменной окружения при запуске:
```bash
DATA_ROOT="$(pwd)/data" src/scripts/main.sh ...
```

3) Абсолютный путь предпочтительнее. `main.sh` нормализует `DATA_ROOT` в абсолютный, если задан.

Приоритет: **переменная окружения > config/app.env**.

---

## Запуск

Аргументы:
```
./src/scripts/main.sh [--group=<строка>] [--subject=<строка>] [--test=<имя>] [--action=<режим>]
```

Флаги:

| Флаг | Пример | Обязательно | Назначение |
|---|---|:---:|---|
| `--group` | `--group=Ae-21-22` | нет | Номер группы. Если не задан — будет запрошен. |
| `--subject` | `--subject="Цирковое_Дело"` | нет | Предмет: `Цирковое_Дело` или `Поп-Культуроведение`. |
| `--test` | `--test=TEST-1` | нет | Имя файла теста (`TEST-1` … `TEST-4`). |
| `--action` | `--action=both` | нет | `max-correct`, `max-wrong`, `both` (по умолчанию). |

Если запустить без флагов — скрипт задаст вопросы интерактивно. Все подсказки/меню печатаются в **stderr**, в **stdout** возвращаются только выбранные значения.

---

## Новый функционал (Task2): досье студента и средняя оценка

Добавлены дополнительные режимы работы с данными студента по предмету:

- `view-dossier` — показать досье студента по предмету
- `add-dossier` — добавить фразу в досье студента по предмету
- `average-grade` — посчитать среднюю оценку студента по предмету

Новые флаги:

- `--student` — ФамилияИО студента (точно как во 2‑й колонке тестов)
- `--phrase` — фраза для добавления в досье (только для `add-dossier`)

Расположение досье:

```
{DATA_ROOT}/{subject}/dossiers/{ФамилияИО}.dossier
```

Если файла нет — он создаётся при первом `add-dossier`.

Шапка создаваемого файла:

```
Фамилия: ИвановИИ
Предмет: Поп-Культуроведение
Дата создания: 2025-11-05 12:34:56
Последнее обновление: 2025-11-05 12:34:56

ФРАЗЫ:
1. Пример фразы
```

Примеры использования:

Показать досье:
```bash
./src/scripts/main.sh --student=ИвановИИ --subject="Поп-Культуроведение" --action=view-dossier
# Если файла нет — "Досье не найдено", если пуст — "Досье пустое"
```

Добавить фразу:
```bash
./src/scripts/main.sh --student=ИвановИИ --subject="Поп-Культуроведение" --action=add-dossier --phrase="Отлично ответил на вопросы"
# Вывод: OK
```

Средняя оценка:
```bash
./src/scripts/main.sh --student=ИвановИИ --subject="Поп-Культуроведение" --action=average-grade
# Пример:
# Средняя оценка по предмету (Поп-Культуроведение) для ИвановИИ: 4.33
```

Сообщения и поведение:

- Если студент ни разу не встречается в тестах предмета:
  - `average-grade` → `Студент не найден`
  - `view-dossier`/`add-dossier` → ошибка с сообщением `Студент не найден` (exit code 1)
- `view-dossier`:
  - нет файла → `Досье не найдено`
  - пустой файл (без фраз) → `Досье пустое`
- `add-dossier` требует `--phrase`, иначе ошибка.

---

## Примеры

Все показатели:
```bash
./src/scripts/main.sh --group=Ae-21-22 --subject="Цирковое_Дело" --test=TEST-1 --action=both
```

Только максимум правильных:
```bash
./src/scripts/main.sh --group=Ae-21-22 --subject="Поп-Культуроведение" --test=TEST-2 --action=max-correct
```

Только максимум неправильных:
```bash
./src/scripts/main.sh --group=Ae-21-22 --subject="Цирковое_Дело" --test=TEST-3 --action=max-wrong
```

---

## Валидации и ошибки

- Проверка наличия файла теста. При отсутствии — завершение с кодом `1`.
- Проверка существования группы в выбранном тесте:
  - При отсутствии — завершение с кодом `1` и список доступных групп.
- Нормализация ввода группы (обрезка пробелов).
- `paths.sh` целиком опирается на `DATA_ROOT`.

---

## Тесты (pytest)

Локально:
```bash
pip install -q pytest
pytest -q src/tests/unit_tests && echo "TESTS PASSED" || (echo "TESTS FAILED"; exit 1)
```

Через Docker:
```bash
docker build -t os-project-tests .
docker run --rm os-project-tests
```

---

## Пример вывода

```
Группа: Ae-21-22
Предмет: Цирковое_Дело
Тест: TEST-1
Студент(ы) с максимальным числом правильных (20): CircusMan
Студент(ы) с максимальным числом неправильных (18): ClownGuy
```

Если у нескольких студентов значение совпадает, выводятся все.

---

## Траблшутинг

- «Файл теста не найден»: проверьте `DATA_ROOT`, `--subject`, `--test`.
- «Группа не найдена»: проверьте `--group` и список доступных групп, напечатанный скриптом.
- В pytest используйте фикстуру окружения или проставляйте `DATA_ROOT` в `env` процесса.

